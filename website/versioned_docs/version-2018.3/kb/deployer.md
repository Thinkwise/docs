---
title: Thinkwise Deployment Center
sidebar_label: Deployment center
id: version-2018.3-deployer
original_id: deployer
---

The Thinkwise Deployment Center (deployer) was created with the intent of making it easier to deploy Thinkwise products.

Products that are currently supported to be deployed by the Thinkwise Deployment Center include:
* Intelligent Application Manager
* Software Factory
* Customer applications (starting from SF/IAM v2018.3 and deployer v1.8.0)
* Windows GUI
* Web GUI
* Indicium

> **Note:** Web GUI and Indicium deployment is currently only available through use of the [Microsoft IIS Administration API](iis_admin_api.html).

The Thinkwise Deployment Center is available as a GUI application (twdeployerGUI.exe) or as a commandline tool (twdeployer.exe). It is currently not possible to download these tools from [TCP](https://office.thinkwisesoftware.com/tcp) separately.
Instead, both are included when downloading an installation package from TCP.

> **Note:** Both versions require that .NET Framework 4.6.1 or higher is installed on the computer that runs the deployer tool.

## Manifest
The manifest is a [JSON](https://en.wikipedia.org/wiki/JSON) configuration file that describes the structure of deployable products inside an installation package to the deployer.
This mostly includes the types of the products contained in the package and the location of the files needed to deploy them.

### Schema
The schema specification version of the manifest dictates the way the deployer translates the contents to deployable products.

Version 1 was created to support installation packages that are downloaded from TCP.
When the schema specification version is not declared inside a manifest the deployer will assume that the schema of said manifest corresponds to version 1.

A schema specification version 2 has been introduced in version 1.8.0 of the deployer to support the creation of manifests for custom applications.
It is not recommended to use version 1 to create custom installations.

Starting from the 1.8.0 release of the deployer manifests using schema 1 are considered deprecated.
However the deployer will remain backwards compatible with such manifests until version 2.0.0.

### Schema specification (v2)
This section describes the structure and properties of a manifest that uses schema specification V2/2.

#### Root properties
| Property | Value | Description | Required |
---|---|---|:---:
schema | 2 or "V2".| Declares the schema version that the manifest file uses. If absent or set to value other than 2/"V2" the deployer assumes schema version 1 is used. | &#10003;
defaultPath| An absolute file path. | Gives the deployer a default directory root path for the following: <br/><br/><ul><li>The directory of the database application files</li><li>The directory to install a Mobile/Windows GUI to. </li></ul> | |
products | A collection of [products](#products). | | &#10003;

#### Products
| Property | Value | Description | Required |
---|---|---|:---:
type | A string with one of the following values: <br/><br/> <ul><li>[IAM](#database-products)</li><li>[SF](#database-products)</li><li>[Application](#database-products)</li><li>[Windows](#gui-indicium-products)</li><li>[Web](#gui-indicium-products)</li><li>[Indicium](#gui-indicium-products)</li><li>[Mobile](#gui-indicium-products)</li></ul> | Declares the type of product that is being described to the deployer. <br/><br/> Depending on the value different properties are expected. | &#10003;

#### Database products
Database products are used for applications generated by a Software Factory.

Valid types for database products are:

* IAM
* SF
* Application

| Property | Value | Description | Required |
---|---|---|:---:
projectId | "MY_APP" | A string corresponding to the application's project ID in the Software Factory that generated the installation/upgrade files. |  Application
version | "2018.2", "2018.3", "2019.1", "1.00", "1.10" etc. | The version of the application contained in the installation package. | &#10003;
metaVersion | "2018.3", "2019.1" etc. | A string corresponding to the IAM/SF version an application is targeting. <br/><br/> **Note:** *For SF and IAM types this value is considered equal to the version property and is therefore ignored.* | Application
projectFolder | "D:\\\\SoftwareFactory\\\\Applications" | An absolute file path that should be equal to the project's project folder specification value that was used when generating the installation scripts, **WITHOUT** the project ID and version parts. <br/><br/> Used to update imported IAM models with the path that the deployer used during installing or upgrading a database product. | &#10003;
dependencies | See [Database dependency values](#database-dependency-values) | A collection of strings that indicate pre-conditions that the database or database engine must satisfy before an install or upgrade can be performed. | |
packages | A collection of [database packages](#database-packages). | Describes which actions the deployer can perform for this database product. | &#10003;

#### Database dependency values
| Value | Checked during | Description | Supported in deployer |
---|---|---|:---:
CompatibilityLevel100 | <ul><li>Install</li><li>Upgrade</li></ul> | Checks if the targeted database (engine) compatibility level is set to 100 (SQL Server 2008 (R2)) or higher during an upgrade or installation. <br/><br/> **Note:** *This is the minimum level for scripts generated by SF/IAM installations from 2017.1 until 2018.3.* | >= 1.8.0
CompatibilityLevel110 | <ul><li>Install</li><li>Upgrade</li></ul> | Checks if the targeted database (engine) compatibility level is set to 110 (SQL Server 2012) or higher during an upgrade or installation. <br/><br/> **Note:** *This is the minimum level for scripts generated by 2018.3 SF/IAM installations and onwards.* | >= 1.8.0
FullTextSearch | <ul><li>Install</li><li>Upgrade</li></ul> | Checks if the [Full-Text Search](https://docs.microsoft.com/en-us/sql/relational-databases/search/full-text-search?view=sql-server-2017) feature is installed on the targeted SQL Server instance. | >= 1.9.0
Invalid | <ul><li>Install</li><li>Upgrade</li></ul> | Represents an unrecognized dependency which will always block deployment. <br/><br/> If you encounter one of these please check if the dependency value you are trying to use is correctly spelled inside the manifest and supported by the deployer version that is being used. | |

#### Database packages
[Database products](#database-products) are only considered full products when they declare at least one package property value.

| Property | Value | Description | Required |
---|---|---|:---:
type | <ul><li>Install</li><li>Upgrade</li><li>Hotfix</li></ul> | The database product sub-type that the package is declaring. <br/><br/> **Note:** *The hotfix sub-type is mostly used in conjunction with the IAM and SF product types. Users wishing to use the hotfix sub-type with the Application product type must adhere to certain rules for the deployer to properly execute such a combination. Please contact Thinkwise Product Innovation for more information about these rules.* | &#10003;
path | <ul><li>"IAM\\\\Install"</li><li>"D:/installation_packages/IAM/Install"</li><li>etc.</li></ul> | A directory path to the root of a generated database application package. <br/><br/> Relative paths are considered relative to the location of the manifest file. | &#10003;
defaultDatabaseName | "THINKWISE_IAM" | A default database name to use during an Install package. <br/><br/> **Note:** *Only used in the deployer GUI.* | |
supportedVersions | A collection of [supported upgrade version properties](#supported-upgrade-versions). | Describes upgrade paths that the deployer can use to upgrade to the current product version. | Upgrade

#### Supported upgrade versions
These properties are used to describe upgrade paths that the deployer can use when upgrading to the version that a database product declares.

| Property | Value | Description | Required
---|---|---|:---:
version | "2017.1", "2018.3", "1.00" etc. | The current version of the database product that is targeted for the upgrade. | &#10003;
upgradesTo | "2018.3", "1.10" etc. | The version that the database product which is targeted for an upgrade will have when all files have been executed. <br/><br/> This is then the next version that the deployer will look for in the supported upgrade version properties to find further upgrade files. <br/><br/> This process continues until the next upgradesTo version is equal to the [product's](#database-products) declared version. <br/><br/> Having an incomplete or looping upgrade path results in an invalid Upgrade product. | &#10003;
files | A collection of path strings. | Absolute or relative path values to the files needed to perform the upgrade from the current version to the upgradesTo version. <br/><br/> Files are executed by the deployer in the order that they are inserted into the collection. <br/><br/> Relative paths are considered relative to the computed value of the [database package's](#database-packages) path property. | &#10003;

#### GUI/Indicium products
These are the properties for all [products](#products) that aren't a database application product.

Valid types for these products are:

* Windows
* Web
* Mobile
* Indicium

> **Note:** Deploying these products through the CLI deployer is currently not supported.
> Web GUI and Indicium deployments require that the [Microsoft IIS Administration API](iis_admin_api.html) is installed on the target server.

| Property | Value | Description | Required
---|---|---|:---:
path | <ul><li>"GUI\\\\Windows"</li><li>"D:/installation/GUI/Web"</li><li>etc.</li></ul> | A directory path to the root of the product files. <br/><br/> Relative paths are considered relative to the location of the manifest file. | &#10003;
shortcutName | "My_mobile_viewer" | Mobile only and optional. <br/><br/> Provides a name for the shortcut to the viewer executable. If not provided the shortcut's name will be "Thinkwise". | |

### Examples
> These examples use the same structure that an installation package downloaded from TCP would use.

#### Win/Web/Mobile/Indicium
```json
{
  "schema": 2,
  "defaultPath": "D:\\SoftwareFactory",
  "products": [
    {
      "type": "Windows",
      "path": "GUI/Windows"
    },
    {
      "type": "Web",
      "path": "GUI/Web"
    },
    {
      "type": "Mobile",
      "path": "GUI/Mobile",
      "shortcutName": "THINKWISE"
    },
    {
      "type": "Indicium",
      "path": "GUI/Indicium"
    }
  ]
}
```

#### IAM
```json
{
  "schema": 2,
  "defaultPath": "D:\\SoftwareFactory",
  "products": [
    {
      "type": "IAM",
      "version": "2018.3",
      "projectFolder": "S:\\Software_fabriek\\Applicaties",
      "dependencies": [
        "CompatibilityLevel110"
      ],
      "packages": [
        {
          "type": "Install",
          "path": "IAM/Install",
          "defaultDatabaseName": "THINKWISE_IAM"
        },
        {
          "type": "Upgrade",
          "path": "IAM/Upgrade",
          "supportedVersions": [
            {
              "version": "G8.11",
              "upgradesTo": "G9.4",
              "files": [
                "G8.11 - G9.2 - Pre upgrade checks.sql",
                "G8.11 - G9.2 - Upgrade.sql",
                "G9.2 - G9.3 - Upgrade.sql",
                "G9.3 - G9.4 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.4",
              "upgradesTo": "G9.5",
              "files": [
                "G9.4 - G9.5 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.5",
              "upgradesTo": "G9.6",
              "files": [
                "G9.5 - G9.6 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.6",
              "upgradesTo": "G9.7",
              "files": [
                "G9.6 - G9.7 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.7",
              "upgradesTo": "G9.8",
              "files": [
                "G9.7 - G9.8 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.8",
              "upgradesTo": "2017.1",
              "files": [
                "G9.8 - 2017.1 - Pre upgrade checks.sql",
                "G9.8 - 2017.1 - Upgrade.sql"
              ]
            },
            {
              "version": "2017.1",
              "upgradesTo": "2018.1",
              "files": [
                "2017.1 - 2018.1 - Upgrade.sql"
              ]
            },
            {
              "version": "2018.1",
              "upgradesTo": "2018.2",
              "files": [
                "2018.1 - 2018.2 - Upgrade.sql"
              ]
            },
            {
              "version": "2018.2",
              "upgradesTo": "2018.3",
              "files": [
                "2018.3\\020_Upgrade.sql",
                "2018.3\\030_Checks.sql",
                "2018.3\\040_Constraints.sql",
                "2018.3\\050_Indexes.sql",
                "2018.3\\060_Functions.sql",
                "2018.3\\070_Views.sql",
                "2018.3\\080_Procedures.sql",
                "2018.3\\090_Instead_of_triggers.sql",
                "2018.3\\100_Triggers.sql",
                "2018.3\\110_Tasks.sql",
                "2018.3\\120_Defaults.sql",
                "2018.3\\130_Layouts.sql",
                "2018.3\\140_Contexts.sql",
                "2018.3\\145_Badges.sql",
                "2018.3\\150_Processes.sql",
                "2018.3\\999_Apply_roles_on_database.sql",
                "2018.3\\999_Manual.sql"
              ]
            }
          ]
        },
        {
          "type": "Hotfix",
          "path": "IAM/Hotfixes"
        }
      ]
    }
  ]
}
```

#### SF
```json
{
  "schema": 2,
  "defaultPath": "D:\\SoftwareFactory",
  "products": [
    {
      "type": "SF",
      "version": "2018.3",
      "dependencies": [
        "CompatibilityLevel110"
      ],
      "packages": [
        {
          "type": "Install",
          "path": "SF/Install",
          "defaultDatabaseName": "THINKWISE_SF"
        },
        {
          "type": "Upgrade",
          "path": "SF/Upgrade",
          "supportedVersions": [
            {
              "version": "G8.11",
              "upgradesTo": "G9.4",
              "files": [
                "G8.11 - G9.2 - Pre upgrade checks.sql",
                "G8.11 - G9.2 - Upgrade.sql",
                "G9.2 - G9.3 - Upgrade.sql",
                "G9.3 - G9.4 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.4",
              "upgradesTo": "G9.5",
              "files": [
                "G9.4 - G9.5 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.5",
              "upgradesTo": "G9.6",
              "files": [
                "G9.5 - G9.6 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.6",
              "upgradesTo": "G9.7",
              "files": [
                "G9.6 - G9.7 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.7",
              "upgradesTo": "G9.8",
              "files": [
                "G9.7 - G9.8 - Upgrade.sql"
              ]
            },
            {
              "version": "G9.8",
              "upgradesTo": "2017.1",
              "files": [
                "G9.8 - 2017.1 - Pre upgrade checks.sql",
                "G9.8 - 2017.1 - Upgrade.sql"
              ]
            },
            {
              "version": "2017.1",
              "upgradesTo": "2018.1",
              "files": [
                "2017.1 - 2018.1 - Upgrade.sql"
              ]
            },
            {
              "version": "2018.1",
              "upgradesTo": "2018.2",
              "files": [
                "2018.1 - 2018.2 - Upgrade.sql"
              ]
            },
            {
              "version": "2018.2",
              "upgradesTo": "2018.3",
              "files": [
                "2018.3\\020_Upgrade.sql",
                "2018.3\\030_Checks.sql",
                "2018.3\\040_Constraints.sql",
                "2018.3\\050_Indexes.sql",
                "2018.3\\060_Functions.sql",
                "2018.3\\070_Views.sql",
                "2018.3\\080_Procedures.sql",
                "2018.3\\081_Data_Procedures.sql",
                "2018.3\\090_Instead_of_triggers.sql",
                "2018.3\\100_Triggers.sql",
                "2018.3\\110_Tasks.sql",
                "2018.3\\120_Defaults.sql",
                "2018.3\\130_Layouts.sql",
                "2018.3\\140_Contexts.sql",
                "2018.3\\145_Badges.sql",
                "2018.3\\150_Processes.sql",
                "2018.3\\999_Apply_roles_on_database.sql",
                "2018.3\\999_Manual.sql"
              ]
            }
          ]
        },
        {
          "type": "Hotfix",
          "path": "SF/Hotfixes"
        }
      ]
    }
  ]
}
```

#### Application
```json
{
  "schema": 2,
  "defaultPath": "D:\\SoftwareFactory",
  "products": [
    {
      "type": "Application",
      "projectId": "MY_APP",
      "version": "1.10",
      "metaVersion": "2018.3",
      "projectFolder": "D:\\SoftwareFactory\\DevApplications",
      "dependencies": [
        "CompatibilityLevel110"
      ],
      "packages": [
        {
          "type": "Install",
          "path": "MY_APP/Install",
          "defaultDatabaseName": "MY_APP"
        },
        {
          "type": "Upgrade",
          "path": "MY_APP/Upgrade",
          "supportedVersions": [
            {
              "version": "1.00",
              "upgradesTo": "1.10",
              "files": [
                "1.10\\020_Upgrade.sql",
                "1.10\\030_Checks.sql",
                "1.10\\040_Constraints.sql",
                "1.10\\050_Indexes.sql",
                "1.10\\060_Functions.sql",
                "1.10\\070_Views.sql",
                "1.10\\080_Procedures.sql",
                "1.10\\090_Instead_of_triggers.sql",
                "1.10\\100_Triggers.sql",
                "1.10\\110_Tasks.sql",
                "1.10\\120_Defaults.sql",
                "1.10\\130_Layouts.sql",
                "1.10\\140_Contexts.sql",
                "1.10\\145_Badges.sql",
                "1.10\\150_Processes.sql",
                "1.10\\999_Apply_roles_on_database.sql"
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

## Creating a custom application package
This section aims to guide developers through the process of using the SF and IAM to generate their installation/upgrade files and then creating a manifest that the deployer CLI or GUI can use to deploy them.

This guide assumes that the developer is familiar with the [development process](../sf/dev_process.html) of the SF, knows how to [synchronize a model](../iam_dev/model.html) into an IAM and has an existing project to use for both.

> **Note:** Installation packages for the SF, IAM, Windows/Web/Mobile GUI and Indicium should mostly be downloaded through [TCP](https://office.thinkwisesoftware.com/tcp).

### Generating the script files
To generate the script files for the installation package follow the [generation process](../sf/creation.html) until the [generate source code](../sf/creation.html#3-generate-source-code) step.

From there make sure the **Generation method** is set to *Full* and that **Write code files to disk** is *checked*.

![Code generation config](assets/deployer_app_guide/code_generation_config.png)
*Code generation screen configurated.*

This will generate script files needed for the installation or upgrade. The scripts can be found in the **Source_code** sub-directory in the folder **Groups** of the project folder. 

It's contents should look similar to the result below.

![Code generation result](assets/deployer_app_guide/code_generation_result.png)
*Script files generated by the Software Factory.*

The project folder can be found in **Project overview**, on the **Project versions** tab.

![Project folder specification location](assets/deployer_app_guide/project_folder_spec.png)
*Project folder specification location.*

### Creating the package
To create the package, the application has to have been configured in IAM. 

This means:

* The model has been [synchronized](../iam_dev/model.html).
* An [application](../iam_admin/admin_applications.html) has been created.
* The [roles](../iam_dev/roles.html) have been created.
* And optionally the [user groups](../iam_admin/user_groups.html)  are created and roles are assigned to these user groups for this application.

In the **Applications** screen there is a **Create scripts for Deployment Center** task available in the task bar.

![Applications deployer task](assets/deployer_app_guide/iam_deployer_task_app.png)
*Deployer task from the Applications screen.*

This task can be used to generate the needed scripts. 

![Deployer task dialog](assets/deployer_app_guide/iam_deployer_task_dialog.png)
*Deployer task dialog.*

In this dialog there are a couple of input fields. The use for each of these is explained in the table below.

Field | Usage |
---|---
Project | The project you're generating deployer compatible installation/upgrade scripts for. <br/><br/> This value should be pre-filled when opening the task dialog.
Project vrs | The project version you're generating deployer compatible installation/upgrade scripts for. <br/><br/> This value should be pre-filled when opening the task dialog.
Application | The previously prepared application you're generating deployer compatible installation/upgrade scripts for. <br/><br/> This value should be pre-filled when opening the task dialog.
Path | The output directory where the installation package will be written to.
Code group folder | This should be filled with the path to the **Groups** directory that contains the script files that were previously [generated](#generating-the-script-files) by the SF.
Remove other project versions | When checked this removes all synchronized project versions that do not match the current version from the targeted IAM after an install or upgrade.
Add user groups | When checked this adds the user groups linked to this application to the targeted IAM after an install or upgrade.
Assign rights to groups | When checked the current roles will be applied to the user groups that are linked to this application in the targeted IAM after an install or upgrade.
Activate application | When checked the application will be automatically set to an active state in the targeted IAM after an install or upgrade.

After using the task, the contents of the directory (used as the **Path** value) should look similar to the one below.

![Deployer task result](assets/deployer_app_guide/iam_deployer_task_result.png)
*Result contents of the task dialog.*

> **Note:** The task always generates an Upgrade directory even if the project version that was generated doesn't have a previous version. If that is the case just delete this directory.

The final step to complete the database packages is to include the files needed by the application.

Add a directory named **Applicaties** at the same level as **Install**, **Upgrade** and **MetaModel**. Then add a sub-directory with the same name as the project ID to the **Applicaties** directory and after that a sub-directory with the version number to the project ID directory. Copy any files that the application needs from the project folder to this application folder. This might include application icons, report files, etc.

> **Note:** In this guide's example the full path to this directory would then be "D:\\deployer_example\\Applicaties\\TEST_SSRS\\1.10".

### Creating the manifest
Create a .json file using the [specification](#schema-specification-v2).

> **Note:** In case of this guide the manifest file is put in the same directory as the generated installation package.

First declare that the manifest will be using [schema](#root-properties) version 2.

```json
{
  "schema": 2
}
```

Next, if you wish to declare a default location to put your application files (like reports, images etc.), enter a directory path using the defaultPath property.

```json
{
  "schema": 2,
  "defaultPath": "D:\\SoftwareFactory"
}
```

Then declare which product types are in the manifest with the [products](#products) property. Use the base type *Application*, since this will be an installation package for a [Software Factory application](#database-products), which is neither the SF itself or IAM. 

```json
{
  "schema": 2,
  "products": [
    {
      "type": "Application"
    }
  ]
}
```

Now that the deployer knows this product is an [application](#database-products) it requires that the project's ID, version, project folder specification and meta version are declared.
Using the example from this guide these would be TEST_SSRS for the ID, 1.10 for the version, S:\\\\Software_fabriek\\\\Applicaties for the project folder and lastly 2018.3 as the meta version since it was generated by a 2018.3 IAM/SF installation.

```json
{
  "schema": 2,
  "products": [
    {
      "type": "Application",
      "projectId": "TEST_SSRS",
      "version": "1.10",
      "metaVersion": "2018.3",
      "projectFolder": "S:\\Software_fabriek\\Applicaties"
    }
  ]
}
```

Optionally you can also declare some [dependencies](#database-dependency-values) that the application requires to make the installation or upgrade succeed.
Since the 2018.3 release of the SF dropped support for SQL Server 2008 R2 we can add the *CompatibilityLevel110* dependency.
This would make sure that the deployer doesn't run the scripts on databases or database engines that don't support features added in SQL Server 2012.

```json
{
  "schema": 2,
  "products": [
    {
      "type": "Application",
      "projectId": "TEST_SSRS",
      "version": "1.10",
      "metaVersion": "2018.3",
      "projectFolder": "S:\\Software_fabriek\\Applicaties",
      "dependencies": [
        "CompatibilityLevel110"
      ]
    }
  ]
}
```

Now that the basic application details have been defined, add the types of [packages](#database-packages) that should be made available to the deployer. In this guide's example these are the *Install* and *Upgrade* package types. 

Starting with the Install package only the type and path to the directory containing the generated installation scripts have to be declared.
Optionally you can also include a default database name for your product to save some input time when using the deployer GUI.

> **Note:** For the path property, relative values are considered relative to the location of the manifest file. In the case of this guide this would be D:\\deployer_example. This means Install/1.10 gets computed to D:\\deployer_example\\Install\\1.10.

```json
{
  "schema": 2,
  "products": [
    {
      "type": "Application",
      "projectId": "TEST_SSRS",
      "version": "1.10",
      "metaVersion": "2018.3",
      "projectFolder": "S:\\Software_fabriek\\Applicaties",
      "dependencies": [
        "CompatibilityLevel110"
      ],
      "packages": [
        {
          "type": "Install",
          "path": "Install\\1.10",
          "defaultDatabaseName": "TEST_SSRS"
        }
      ]
    }
  ]
}
```

Just like with the Install package, add a type and path value for the Upgrade package.

```json
{
  "schema": 2,
  "products": [
    {
      "type": "Application",
      "projectId": "TEST_SSRS",
      "version": "1.10",
      "metaVersion": "2018.3",
      "projectFolder": "S:\\Software_fabriek\\Applicaties",
      "dependencies": [
        "CompatibilityLevel110"
      ],
      "packages": [
        {
          "type": "Install",
          "path": "Install\\1.10",
          "defaultDatabaseName": "TEST_SSRS"
        },
        {
          "type": "Upgrade",
          "path": "Upgrade\\1.10"
        }
      ]
    }
  ]
}
```

Next describe the upgrade path for databases that are currently at a previous version of the application. This is done using the [supportedVersions](#supported-upgrade-versions) property.

The deployer uses this property to determine which files are needed to perform the upgrade and in which order they should be executed.
In this guide we generated files for our installation package to upgrade from version 1.00 to 1.10 so those are used as the values for version and upgradesTo properties respectively.

As a rule of thumb when adding the file paths, always follow the number ordering that the SF used when generating your files.

> **Note:** Once again these paths may be relative but instead of being relative to the location of the manifest file they're relative to the product's computed path value.
> This means that a computed product path value of D:\\deployer_example\\Upgrade and a file value of 1.10\\020_Upgrade.sql would become D:\\deployer_example\\Upgrade\\1.10\\020_Upgrade.sql.

```json
{
  "schema": 2,
  "products": [
    {
      "type": "Application",
      "projectId": "TEST_SSRS",
      "version": "1.10",
      "metaVersion": "2018.3",
      "projectFolder": "S:\\Software_fabriek\\Applicaties",
      "dependencies": [
        "CompatibilityLevel110"
      ],
      "packages": [
        {
          "type": "Install",
          "path": "Install\\1.10",
          "defaultDatabaseName": "TEST_SSRS"
        },
        {
          "type": "Upgrade",
          "path": "Upgrade\\1.10",
          "supportedVersions": [
            {
              "version": "1.00",
              "upgradesTo": "1.10",
              "files": [
                "020_Upgrade.sql",
                "030_Checks.sql",
                "040_Constraints.sql",
                "050_Indexes.sql",
                "060_Functions.sql",
                "070_Views.sql",
                "080_Procedures.sql",
                "090_Instead_of_triggers.sql",
                "100_Triggers.sql",
                "110_Tasks.sql",
                "120_Defaults.sql",
                "130_Layouts.sql",
                "140_Contexts.sql",
                "145_Badges.sql",
                "150_Processes.sql",
                "999_Apply_roles_on_database.sql"
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

It is recommended to put all the upgrade scripts in a project version folder so upgrades from multiple versions are supported in one deloyer package. 

```json
{
  "schema": 2,
  "products": [
    {
      "type": "Application",
      "projectId": "TEST_SSRS",
      "version": "1.20",
      "metaVersion": "2018.3",
      "projectFolder": "S:\\Software_fabriek\\Applicaties",
      "dependencies": [
        "CompatibilityLevel110"
      ],
      "packages": [
        {
          "type": "Install",
          "path": "Install\\1.20",
          "defaultDatabaseName": "TEST_SSRS"
        },
        {
          "type": "Upgrade",
          "path": "Upgrade",
          "supportedVersions": [
            {
              "version": "1.00",
              "upgradesTo": "1.10",
              "files": [
                "1.10\\020_Upgrade.sql",
                "1.10\\030_Checks.sql",
                "1.10\\040_Constraints.sql",
                "1.10\\050_Indexes.sql",
                "1.10\\060_Functions.sql",
                "1.10\\070_Views.sql",
                "1.10\\080_Procedures.sql",
                "1.10\\090_Instead_of_triggers.sql",
                "1.10\\100_Triggers.sql",
                "1.10\\110_Tasks.sql",
                "1.10\\120_Defaults.sql",
                "1.10\\130_Layouts.sql",
                "1.10\\140_Contexts.sql",
                "1.10\\145_Badges.sql",
                "1.10\\150_Processes.sql",
                "1.10\\999_Apply_roles_on_database.sql"
              ]
            },
            {
              "version": "1.10",
              "upgradesTo": "1.20",
              "files": [
                "1.20\\020_Upgrade.sql",
                "1.20\\030_Checks.sql",
                "1.20\\040_Constraints.sql",
                "1.20\\050_Indexes.sql",
                "1.20\\060_Functions.sql",
                "1.20\\070_Views.sql",
                "1.20\\080_Procedures.sql",
                "1.20\\090_Instead_of_triggers.sql",
                "1.20\\100_Triggers.sql",
                "1.20\\110_Tasks.sql",
                "1.20\\120_Defaults.sql",
                "1.20\\130_Layouts.sql",
                "1.20\\140_Contexts.sql",
                "1.20\\145_Badges.sql",
                "1.20\\150_Processes.sql",
                "1.20\\999_Apply_roles_on_database.sql"
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

Using the example manifest above, when the deployer encounters a version 1.00 database it'll first upgrade the database to 1.10 and then, since the database is now at version 1.10, it can upgrade to 1.20.

> **Note:** To avoid deployment failures please make sure the upgrade path always ends at a supported version whose upgradesTo value is equal to the product's declared version.

### Customizing the application model import (Advanced)
> **Note:** Customizing an application's model import script requires knowledge about IAM's application model and SQL.<br/><br/>
> **When in doubt please contact your Thinkwise consultant before running queries against an IAM model.**

The basic options to customize the import model script inside the [package creation task](#creating-the-package) provide a way to import said model in a similar way to SF and IAM installations.
This is a decent default for most applications but you might want to be able to differ slightly from certain options.

For example, instead of removing all other project versions using the *Remove other project versions* option, you might also want to keep the most recent version and set it to inactive instead.

To make this customization work we first need to create a query that removes all other project versions except the current and directly previous ones.
In this case we can use the query that the *Remove other project versions* generates as a starting example.

> **Note:** The following example uses the same project that was used during the rest of the [guide](#creating-a-custom-application-package).
> It also assumes that the final installation package was created while the mentioned task options were left unchecked.

```sql
/****************************************************
 * Remove old project version
 ****************************************************/

    declare @d_project_vrs_id project_vrs_id
    declare c_project_vrs cursor local fast_forward read_only
    for
        select project_vrs_id 
        from project_vrs
        where project_id = 'TEST_SSRS'
        and project_vrs_id <> '1.10'
    
    open c_project_vrs
    fetch next from c_project_vrs 
    into @d_project_vrs_id
    
    while (@@fetch_status <> -1)
    begin
        if (@@fetch_status = 0)
        begin
    
                EXEC task_delete_project_vrs
                @project_id = 'TEST_SSRS',
                @project_vrs_id = @d_project_vrs_id
    
        end
        fetch next from c_project_vrs 
        into @d_project_vrs_id
    
    end
    close c_project_vrs
    deallocate c_project_vrs
```

As shown, the query creates a cursor for records inside the *project_vrs* table that match our application's *project_id* ('TEST_SSRS') and the latest *project_vrs_id* ('1.10').
For each of the records that were found it then calls the *task_delete_project_vrs* stored procedure (which is part of the IAM application model) to delete the project versions from IAM.

To get the desired result we can modify the cursor's select statement to also exclude the project's previous version:

```sql
    declare @d_project_vrs_id project_vrs_id
    declare c_project_vrs cursor local fast_forward read_only
    for
        select project_vrs_id 
        from project_vrs
        where project_id = 'TEST_SSRS'
        and project_vrs_id <> '1.10'
        and project_vrs_id <> '1.00'

-- Rest omitted
```

Or alternatively if you can ensure that application versions are always imported chronologically:

```sql
    declare @d_project_vrs_id project_vrs_id
    declare c_project_vrs cursor local fast_forward read_only
    for
        select project_vrs_id 
        from project_vrs
        where project_id = 'TEST_SSRS'
        and project_vrs_id not in (select top 2 project_vrs_id 
        -- top 2 instead of 1 since the first of those is the current version that was just imported.
                                     from project_vrs
                                    where project_id = 'TEST_SSRS'
                                 order by insert_date_time)

-- Rest omitted
```

Now that the previous/most recent version is no longer deleted it just has to be set to inactive.
Once again we can use one of the default option scripts, *Activate application*, as a base example.

```sql
/****************************************************
 * Activate application
 ****************************************************/

    update gui_appl
       set active = 1
     where project_id       = 'TEST_SSRS'
       and project_vrs_id   = '1.10'
       and gui_appl_id      = @gui_appl_id
```

As shown this simply updates the *active* column inside the *gui_appl* table for the imported project version and sets it to 1 (true).
So to set the previous version to inactive we need to update the value of this column to 0 (false).

What you may have noticed is that this script uses a variable, *@gui_appl_id*, to search for a specific application id to activate.
This variable is filled in another part of the generated import script which, as explained later, we don't have access to.

However if our goal is to simply deactivate the remaining applications for the project we don't really need to know the gui_appl_id of those.
Instead we could simply invert the *project_vrs_id* condition to target all applications that do not belong to the version that was just imported:

```sql
/****************************************************
 * Deactivate applications
 ****************************************************/

    update gui_appl
       set active = 0
     where project_id       = 'TEST_SSRS'
       and project_vrs_id   <> '1.10'
```

Now that we have the SQL statements for our scripts they need to be added to the installation package.
Navigate to the directory where you put the generated installation package and look for the *MetaModel* directory.
In here you should see a sql file similar to the one below.

![Meta Model](assets/deployer_app_guide/install_package_metamodel.png)

> **Note:** This is the generated application model import script **WHICH YOU SHOULD NOT MODIFY**.

Create another sql file and give it a name that results in it getting sorted later alphabetically than the generated file.
This ensures that the deployer will execute the generated script before our custom one.
In this example the name *Import_TEST_SSRS_model_2.sql* is used.

![Meta Model](assets/deployer_app_guide/install_package_metamodel_custom.png)

Next put the customized scripts into the file which, for this example, would be the following:

```sql
/****************************************************
 * Remove project versions
 ****************************************************/

    declare @d_project_vrs_id project_vrs_id
    declare c_project_vrs cursor local fast_forward read_only
    for
        select project_vrs_id 
        from project_vrs
        where project_id = 'TEST_SSRS'
        and project_vrs_id <> '1.10'
        and project_vrs_id <> '1.00'
        -- Or the one based on insert_date_time depending on which you prefer.
    
    open c_project_vrs
    fetch next from c_project_vrs 
    into @d_project_vrs_id
    
    while (@@fetch_status <> -1)
    begin
        if (@@fetch_status = 0)
        begin
    
                EXEC task_delete_project_vrs
                @project_id = 'TEST_SSRS',
                @project_vrs_id = @d_project_vrs_id
    
        end
        fetch next from c_project_vrs 
        into @d_project_vrs_id
    
    end
    close c_project_vrs
    deallocate c_project_vrs
go

/****************************************************
 * Deactivate applications
 ****************************************************/

    update gui_appl
       set active = 0
     where project_id       = 'TEST_SSRS'
       and project_vrs_id   <> '1.10'
```

Then save it using [Western Windows-1252](https://en.wikipedia.org/wiki/Windows-1252) encoding and you'll be done.

> **IMPORTANT:** Windows-1252 is used by the SF and IAM as the encoding for generated scripts.<br/>
> Due to this the deployer also assumes this encoding is used when reading the scripts.<br/><br/>
> **PLEASE DO NOT USE** UTF-8 or similar encodings when saving/editing the customized scripts to avoid unexpected errors when deploying your application.